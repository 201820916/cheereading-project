{% extends "base.html" %}

{% block title %}회원가입{% endblock %}

{% block extra_css %}
<style>
    /* 페이지에 따뜻한 느낌을 주는 배경색과 질감 */
    body {
        background-color: #FDFCFB;
        background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23e9e4d9' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
    }
    /* 카드 디자인 개선 */
    .card {
        border: 1px solid #EAE6E0;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    /* Cheereading 테마에 맞는 버튼 색상 */
    .btn-primary {
        background-color: #4A675A;
        border-color: #4A675A;
        padding: 10px;
        font-weight: bold;
    }
    .btn-primary:hover {
        background-color: #3B5043;
        border-color: #3B5043;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="card p-4">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">회원가입</h3>
                    <form method="post">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                            </div>
                        {% endif %}

                        <h6 class="text-muted mb-3">계정 정보</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.username.id_for_label }}" class="form-label">{{ form.username.label }}</label>
                                {{ form.username }}
                                {% for error in form.username.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.nickname.id_for_label }}" class="form-label">{{ form.nickname.label }}</label>
                                {{ form.nickname }}
                                {% for error in form.nickname.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                            {{ form.email }}
                            {% for error in form.email.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.password1.id_for_label }}" class="form-label">비밀번호</label>
                                {{ form.password1 }}
                                {% for error in form.password1.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.password2.id_for_label }}" class="form-label">비밀번호 확인</label>
                                {{ form.password2 }}
                                <div id="password-match-message" class="small mt-1"></div>
                                {% for error in form.password2.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                        </div>
                        <div id="passwordHelp" class="form-text text-muted small mb-4">
                            비밀번호는 8자 이상, 아이디와 다른 값, 너무 흔하지 않은 값으로 설정해주세요.
                        </div>

                        <hr class="my-4">

                        <h6 class="text-muted mb-3">추가 정보</h6>
                        <div class="row">
                             <div class="col-md-6 mb-3">
                                <label for="{{ form.age.id_for_label }}" class="form-label">{{ form.age.label }}</label>
                                {{ form.age }}
                                {% for error in form.age.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.gender.id_for_label }}" class="form-label">{{ form.gender.label }}</label>
                                {{ form.gender }}
                                {% for error in form.gender.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                        </div>

                         <h6 class="text-muted mb-3 mt-3">선호 장르 (최대 3개)</h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.preferred_genre_1 }}
                                {% for error in form.preferred_genre_1.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.preferred_genre_2 }}
                                {% for error in form.preferred_genre_2.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                             <div class="col-md-4 mb-3">
                                {{ form.preferred_genre_3 }}
                                {% for error in form.preferred_genre_3.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                            </div>
                        </div>
                        
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary">가입하기</button>
                        </div>
                    </form>
                </div>
            </div>
             <p class="text-center text-muted small mt-3">
                본 서비스의 도서 데이터는 <a href="http://data4library.kr/" target="_blank">도서관 정보나루</a>에서 제공하는 OPEN API를 활용하였으며, 해당 데이터는 CC-BY 라이선스를 따릅니다.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('id_password1');
    const confirmPasswordInput = document.getElementById('id_password2');
    const messageDiv = document.getElementById('password-match-message');

    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        if (confirmPassword) {
            if (password === confirmPassword) {
                messageDiv.textContent = '✅ 비밀번호가 일치합니다.';
                messageDiv.className = 'small mt-1 text-success';
            } else {
                messageDiv.textContent = '❌ 비밀번호가 일치하지 않습니다.';
                messageDiv.className = 'small mt-1 text-danger';
            }
        } else {
            messageDiv.textContent = '';
        }
    }
    passwordInput.addEventListener('keyup', checkPasswordMatch);
    confirmPasswordInput.addEventListener('keyup', checkPasswordMatch);
});
</script>
{% endblock %}